<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE en-export SYSTEM "http://xml.evernote.com/pub/evernote-export2.dtd">
<en-export export-date="20180113T140347Z" application="Evernote/Windows" version="6.x">
<note><title>5、逻辑层——app.js注册程序</title><content><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd">

<en-note><div><span style="font-size: 32px;"><b>5、逻辑层——app.js注册程序</b></span></div><hr/><div><br/></div><div><span style="font-size: 24px;"><b>（1）app({})</b></span></div><hr/><ul><li>App() 函数用来注册一个小程序。接受一个 object 参数，其指定小程序的生命周期函数</li><li>属性</li></ul><table><thead><tr><th>属性</th><th>类型</th><th>描述</th><th>触发时机</th></tr></thead><tbody><tr><td>onLaunch</td><td>Function</td><td>生命周期函数--监听小程序初始化</td><td>当小程序初始化完成时，会触发 onLaunch（全局只触发一次）</td></tr><tr><td>onShow</td><td>Function</td><td>生命周期函数--监听小程序显示</td><td>当小程序启动，或从后台进入前台显示，会触发 onShow</td></tr><tr><td>onHide</td><td>Function</td><td>生命周期函数--监听小程序隐藏</td><td>当小程序从前台进入后台，会触发 onHide</td></tr><tr><td>onError</td><td>Function</td><td>错误监听函数</td><td>当小程序发生脚本错误，或者 api 调用失败时，会触发 onError 并带上错误信息</td></tr><tr><td>其他</td><td>Any</td><td><br/></td><td>开发者可以添加任意的函数或数据到 Object 参数中，用 <code>this</code> 可以访问</td></tr></tbody></table><ul><li>前后台定义
<ul><li>当用户点击左上角关闭，或者按了设备 Home 键离开微信，小程序并没有直接销毁，而是进入了后台；</li><li>当再次进入微信或再次打开小程序，又会从后台进入前台。</li><li>需要注意的是：只有当小程序进入后台一定时间，或者系统资源占用过高，才会被真正的销毁</li></ul></li><li>onLaunch, onShow 参数</li></ul><div><table><thead><tr><th>字段</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>path</td><td>String</td><td>打开小程序的路径</td></tr><tr><td>query</td><td>Object</td><td>打开小程序的query</td></tr><tr><td>scene</td><td>Number</td><td>打开小程序的场景值</td></tr><tr><td>shareTicket</td><td>String</td><td>shareTicket，详见 <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/share.html#获取更多转发信息">获取更多转发信息</a></td></tr><tr><td>referrerInfo</td><td>Object</td><td>当场景为由从另一个小程序或公众号或App打开时，返回此字段</td></tr><tr><td>referrerInfo.appId</td><td>String</td><td>来源小程序或公众号或App的 appId，详见下方说明</td></tr><tr><td>referrerInfo.extraData</td><td>Object</td><td>来源小程序传过来的数据，scene=1037或1038时支持</td></tr></tbody></table></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>//app.js</div><div>App({</div><div style="margin-left:40px;">onLaunch: function (<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">options</span>){</div><div style="margin-left:40px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;小程序onLaunch&quot;+options)</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">onShow: function (<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">options</span>){</div><div style="margin-left:40px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;小程序onShow&quot; + options)</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">onHide:function(){</div><div style="margin-left:40px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;小程序onHide&quot;)</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">onError: function (<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">msg</span>){</div><div style="margin-left:40px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;小程序onError&quot;+msg)</div><div style="margin-left:40px;">},</div><div style="margin-left:40px;">globalData:{</div><div style="margin-left:40px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userInfo: null</div><div style="margin-left:40px;">}</div><div>})</div></div><div><br/></div><div><span style="font-size: 24px;"><b>（2）getApp()</b></span></div><div><hr/></div><ul><li>全局的 getApp() 函数可以用来获取到小程序实例。</li></ul><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>// other.jsvar appInstance = getApp()</div><div>console.log(appInstance.globalData) // I am global data</div></div><ul><li>注意
<ul><li>App() 必须在 app.js 中注册，且不能注册多个</li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">不要在定义于 App() 内的函数中调用 getApp() ，使用 this 就可以拿到 app 实例</span></li><li>不要在 onLaunch 的时候调用 <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">getCurrentPages()</span>，此时 page 还没有生成</li><li>通过 getApp() 获取实例之后，<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">不要私自调用生命周期函数</span></li></ul></li></ul><div><br/></div></en-note>]]></content><created>20171228T093352Z</created><updated>20171229T065848Z</updated><note-attributes><author>372251027@qq.com</author><source>desktop.win</source><source-url>https://mp.weixin.qq.com/debug/wxadoc/dev/framework/app-service/app.html</source-url><source-application>evernote.win32</source-application></note-attributes></note></en-export>
