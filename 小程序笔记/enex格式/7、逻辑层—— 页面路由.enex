<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE en-export SYSTEM "http://xml.evernote.com/pub/evernote-export2.dtd">
<en-export export-date="20180113T140359Z" application="Evernote/Windows" version="6.x">
<note><title>7、逻辑层—— 页面路由</title><content><![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd">

<en-note><div><span style="font-size: 32px;"><b>7、</b></span><span style="font-size: 32px;"><b>逻辑层——</b></span> <span style="font-size: 32px;"><b>页面路由</b></span></div><hr/><div><br/></div><div><span style="font-size: 24px;"><b>（1）页面栈</b></span></div><hr/><ul><li>框架以栈的形式维护了当前的所有页面。 当发生路由切换的时候，页面栈的表现如下：</li></ul><table><thead><tr><th>路由方式</th><th>页面栈表现</th></tr></thead><tbody><tr><td>初始化</td><td>新页面入栈</td></tr><tr><td>打开新页面</td><td>新页面入栈</td></tr><tr><td>页面重定向</td><td>当前页面出栈，新页面入栈</td></tr><tr><td>页面返回</td><td>页面不断出栈，直到目标返回页，新页面入栈</td></tr><tr><td>Tab 切换</td><td>页面全部出栈，只留下新的 Tab 页面</td></tr><tr><td>重加载</td><td>页面全部出栈，只留下新的页面</td></tr></tbody></table><div><br/></div><div><span style="font-size: 24px;"><b>（2）查看页面栈</b></span></div><hr/><ul><li>查看当前页面的路由</li></ul><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>onLoad: function() {</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&apos;你好&apos;);</div><div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(this.route);//pages/index/index</div><div>}</div></div><ul><li>查看页面栈</li><li>getCurrentPages() 函数用于获取当前页面栈的实例，以数组形式按栈的顺序给出，第一个元素为首页，最后一个元素为当前页面</li><li>不要尝试修改页面栈，会导致路由以及页面状态错误</li></ul><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>onLoad: function() {</div><div><br/></div><div style="margin-left:40px;">console.log(&apos;你好&apos;);</div><div style="margin-left:40px;">console.log(<span style="color: rgb(255, 0, 0);"><b><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">getCurrentPages()</span></b></span>.length);</div><div style="margin-left:40px;">console.log(getCurrentPages()[0]);</div><div style="margin-left:40px;">}</div></div><div><br/></div><div><span style="font-size: 24px;"><b>（3）页面跳转时路由分析</b></span></div><div><hr/></div><ul><li>非tab跳转时路由变化</li></ul><table><thead><tr><th>路由方式</th><th>触发时机</th><th>路由前页面</th><th>路由后页面</th></tr></thead><tbody><tr><td>初始化</td><td>小程序打开的第一个页面</td><td><br/></td><td>onLoad, onShow</td></tr><tr><td>打开新页面</td><td>调用 API <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/ui-navigate.html#wxnavigatetoobject"><code>wx.navigateTo</code></a> 或使用组件 <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/component/navigator.html"><code>&lt;navigator open-type=&quot;navigateTo&quot;/&gt;</code></a></td><td>onHide</td><td>onLoad, onShow</td></tr><tr><td>页面重定向</td><td>调用 API <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/ui-navigate.html#wxredirecttoobject"><code>wx.redirectTo</code></a> 或使用组件 <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/component/navigator.html"><code>&lt;navigator open-type=&quot;redirectTo&quot;/&gt;</code></a></td><td>onUnload</td><td>onLoad, onShow</td></tr><tr><td>页面返回</td><td>调用 API <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/ui-navigate.html#wxnavigateback"><code>wx.navigateBack</code></a> 或使用组件<a href="https://mp.weixin.qq.com/debug/wxadoc/dev/component/navigator.html"><code>&lt;navigator open-type=&quot;navigateBack&quot;&gt;</code></a>或用户按左上角返回按钮</td><td>onUnload</td><td>onShow</td></tr><tr><td>Tab 切换</td><td>调用 API <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/ui-navigate.html#wxswitchtab"><code>wx.switchTab</code></a> 或使用组件 <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/component/navigator.html"><code>&lt;navigator open-type=&quot;switchTab&quot;/&gt;</code></a> 或用户切换 Tab</td><td><br/></td><td>各种情况请参考下表</td></tr><tr><td>重启动</td><td>调用 API <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/api/ui-navigate.html#wxrelaunch"><code>wx.reLaunch</code></a> 或使用组件 <a href="https://mp.weixin.qq.com/debug/wxadoc/dev/component/navigator.html"><code>&lt;navigator open-type=&quot;reLaunch&quot;/&gt;</code></a></td><td>onUnload</td><td>onLoad, onShow</td></tr></tbody></table><ul><li>TAB切换时路由变化</li></ul><div><table><thead><tr><th>当前页面</th><th>路由后页面</th><th>触发的生命周期（按顺序）</th></tr></thead><tbody><tr><td>A</td><td>A</td><td>Nothing happend</td></tr><tr><td>A</td><td>B</td><td>A.onHide(), B.onLoad(), B.onShow()</td></tr><tr><td>A</td><td>B（再次打开）</td><td>A.onHide(), B.onShow()</td></tr><tr><td>C</td><td>A</td><td>C.onUnload(), A.onShow()</td></tr><tr><td>C</td><td>B</td><td>C.onUnload(), B.onLoad(), B.onShow()</td></tr><tr><td>D</td><td>B</td><td>D.onUnload(), C.onUnload(), B.onLoad(), B.onShow()</td></tr><tr><td>D（从转发进入）</td><td>A</td><td>D.onUnload(), A.onLoad(), A.onShow()</td></tr><tr><td>D（从转发进入）</td><td>B</td><td>D.onUnload(), B.onLoad(), B.onShow()</td></tr></tbody></table></div></en-note>]]></content><created>20171229T030348Z</created><updated>20171229T065905Z</updated><note-attributes><author>372251027@qq.com</author><source>desktop.win</source><source-url>https://mp.weixin.qq.com/debug/wxadoc/dev/framework/app-service/route.html</source-url><source-application>evernote.win32</source-application></note-attributes></note></en-export>
