<html>
<head>
  <title>6、逻辑层—— page.js注册页面</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.16299 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 12pt;
    }
  </style>
</head>
<body>
<a name="9038"/>
<h1>6、逻辑层—— page.js注册页面</h1>

<div>
<span><div><span style="font-size: 32px;"><b>6、</b></span><span style="font-size: 32px;"><b>逻辑层——</b></span> <span style="font-size: 32px;"><b>page.js注册页面</b></span></div><div><hr/></div><div><br/></div><div><span style="font-size: 24px;"><b>（1）Page(object)函数</b></span></div><div><hr/></div><ul><li>Page() 函数用来注册一个页面。接受一个 object 参数，其指定页面的初始数据、生命周期函数、事件处理函数等</li><li>object 内容在页面加载时会进行一次深拷贝，需考虑数据大小对页面加载的开销</li><li>属性列表</li></ul><table><thead><tr><th>属性</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td><a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/app-service/page.html#初始化数据">data</a></td><td>Object</td><td>页面的初始数据</td></tr><tr><td><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">onLoad</span></td><td>Function</td><td>生命周期函数--监听页面加载</td></tr><tr><td><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">onReady</span></td><td>Function</td><td>生命周期函数--监听页面初次渲染完成</td></tr><tr><td><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">onShow</span></td><td>Function</td><td>生命周期函数--监听页面显示</td></tr><tr><td><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">onHide</span></td><td>Function</td><td>生命周期函数--监听页面隐藏</td></tr><tr><td><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">onUnload</span></td><td>Function</td><td>生命周期函数--监听页面卸载</td></tr><tr><td>onPullDownRefresh</td><td>Function</td><td>页面相关事件处理函数--监听用户下拉动作</td></tr><tr><td>onReachBottom</td><td>Function</td><td>页面上拉触底事件的处理函数</td></tr><tr><td>onShareAppMessage</td><td>Function</td><td>用户点击右上角转发</td></tr><tr><td>onPageScroll</td><td>Function</td><td>页面滚动触发事件的处理函数</td></tr><tr><td>其他</td><td>Any</td><td>开发者可以添加任意的函数或数据到 object 参数中，在页面的函数中用 <code>this</code> 可以访问</td></tr></tbody></table><ul><li>代码例子</li></ul><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>//index.js<br/>
Page({<br/>
  <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">data</span>: {<br/>
    text: &quot;This is page data.&quot;<br/>
  },<br/>
  onLoad: function(<span style="color: rgb(255, 0, 0);"><b><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">options</span></b></span>) {<br/>
    // Do some initialize when page load.<br/>
  },<br/>
  onReady: function() {<br/>
    // Do something when page ready.<br/>
  },<br/>
  onShow: function() {<br/>
    // Do something when page show.<br/>
  },<br/>
  onHide: function() {<br/>
    // Do something when page hide.<br/>
  },<br/>
  onUnload: function() {<br/>
    // Do something when page close.<br/>
  },<br/>
  onPullDownRefresh: function() {<br/>
    // Do something when pull down.<br/>
  },<br/>
  onReachBottom: function() {<br/>
    // Do something when page reach bottom.<br/>
  },<br/>
  onShareAppMessage: function () {<br/>
  // return custom share data when user share.<br/>
  },<br/>
  onPageScroll: function() {<br/>
    // Do something when page scroll<br/>
  },<br/>
  // Event handler.<br/>
  <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">viewTap: function() {</span><br/>
    this.setData({<br/>
      text: 'Set some data for updating view.'<br/>
    }, function() {<br/>
      // this is setData callback<br/>
    })<br/>
  },<br/>
  <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">customData</span>: {<br/>
    hi: 'MINA'<br/>
  }<br/>
})</div></div><div><br/></div><div><span style="font-size: 24px;"><b>（2）数据绑定</b></span></div><div><hr/></div><ul><li>初始化数据将作为页面的第一次渲染。data 将会以 JSON 的形式<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">由逻辑层传至渲染层</span>，所以其数据必须是可以转成 JSON 的格式：字符串，数字，布尔值，对象，数组</li><li>代码例子</li></ul><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>//渲染层WXML</div><div>&lt;view&gt;{{text}}&lt;/view&gt;</div><div>&lt;view&gt;{{array[0].msg}}&lt;/view&gt;</div><div><br/></div><div>//逻辑层js</div><div>Page({<br/>
  data: {<br/>
    text: 'init data',<br/>
    array: [{msg: '1'}, {msg: '2'}]<br/>
  }</div><div>})</div></div><ul><li>setData 函数用于将数据从逻辑层发送到视图层（异步），同时改变对应的 this.data 的值（同步）</li></ul><table><thead><tr><th>字段</th><th>类型</th><th>必填</th><th>描述</th><th>最低版本</th></tr></thead><tbody><tr><td>data</td><td>Object</td><td>是</td><td>这次要改变的数据</td><td><br/></td></tr><tr><td>callback</td><td>Function</td><td>否</td><td>回调函数</td><td><a href="https://mp.weixin.qq.com/debug/wxadoc/dev/framework/compatibility.html" title="基础库 1.5.0 开始支持，低版本需做兼容处理。">1.5.0</a></td></tr></tbody></table><ul><li>object 以 key，value 的形式表示将 this.data 中的 key 对应的值改变成 value</li><li>callback 是一个回调函数，在这次setData对界面渲染完毕后调用</li><li>其中 key 可以非常灵活，以数据路径的形式给出，如 array[2].message，a.b.c.d，<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">并且不需要在 this.data 中预先定义</span>。</li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">直接修改 this.data 而不调用 this.setData 是无法改变页面的状态的，还会造成数据不一致</span></li><li>单次设置的数据<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">不能超过1024kB</span>，请尽量避免一次设置过多的数据。</li><li>请不要把 data 中任何一项的 value 设为 <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">undefined</span> ，否则这一项将不被设置并可能遗留一些潜在问题。</li><li>代码例子</li></ul><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><br/></span></span></span></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;!--index.wxml--&gt;</div><div>&lt;view&gt;{{text}}&lt;/view&gt;</div><div>&lt;button bindtap=&quot;changeText&quot;&gt; Change normal data &lt;/button&gt;</div><div><br/></div><div>&lt;view&gt;{{num}}&lt;/view&gt;</div><div>&lt;button bindtap=&quot;changeNum&quot;&gt; Change normal num &lt;/button&gt;</div><div><br/></div><div>&lt;view&gt;{{array[0].text}}&lt;/view&gt;</div><div>&lt;button bindtap=&quot;changeItemInArray&quot;&gt; Change Array data &lt;/button&gt;</div><div><br/></div><div>&lt;view&gt;{{object.text}}&lt;/view&gt;</div><div>&lt;button bindtap=&quot;changeItemInObject&quot;&gt; Change Object data &lt;/button&gt;</div><div><br/></div><div>&lt;view&gt;{{newField.text}}&lt;/view&gt;</div><div>&lt;button bindtap=&quot;addNewField&quot;&gt; Add new data &lt;/button&gt;</div><div><br/></div><div>//index.js<br/>
Page({<br/>
  data: {<br/>
    text: 'init data',<br/>
    num: 0,<br/>
    array: [{text: 'init data'}],<br/>
    object: {<br/>
      text: 'init data'<br/>
    }<br/>
  },<br/>
  changeText: function() {<br/>
    // this.data.text = 'changed data'  // bad, it can not work<br/>
    this.setData({<br/>
      <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">text: 'changed data'</span><br/>
    })<br/>
  },<br/>
  changeNum: function() {<br/>
    this.data.num = 1<br/>
    this.setData({<br/>
      <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">num: this.data.num</span><br/>
    })<br/>
  },<br/>
  changeItemInArray: function() {<br/>
    // you can use this way to modify a danamic data path<br/>
    this.setData({<br/>
      <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">'array[0].text':'changed data'</span><br/>
    })<br/>
  },<br/>
  changeItemInObject: function(){<br/>
    this.setData({<br/>
      <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">'object.text': 'changed data'</span><br/>
    });<br/>
  },<br/>
  addNewField: function() {<br/>
    this.setData({<br/>
      <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">'newField.text': 'new data'</span><br/>
    })<br/>
  }<br/>
})</div></div><div><span style="font-size: 12px;"><span style="font-family: Monaco, Menlo, Consolas, 'Courier New', monospace;"><span style="color: rgb(51, 51, 51);"><br/></span></span></span></div><div><br/></div><div><span style="font-size: 24px;"><b>（3）生命周期函数</b></span></div><div><hr/></div><ul><li>onLoad: 页面加载
<ul><li>一个页面只会调用一次，可以在 onLoad 中获取打开当前页面所调用的 <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">query 参数</span></li></ul></li><li>onShow: 页面显示
<ul><li>每次打开页面都会调用一次。</li></ul></li><li>onReady: 页面初次渲染完成
<ul><li>一个页面只会调用一次，代表页面已经准备妥当，可以和视图层进行交互</li><li><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">对界面的设置如wx.setNavigationBarTitle请在onReady之后设置</span>。详见生命周期</li></ul></li><li>onHide: 页面隐藏
<ul><li>当navigateTo或底部tab切换时调用。</li></ul></li><li>onUnload: 页面卸载
<ul><li>当redirectTo或navigateBack的时候调用</li></ul></li></ul><div><img src="6、逻辑层—— page.js注册页面_files/Image.png" type="image/png" style="height: auto;"/></div><div><span style="font-size: 24px;"><b>（4）页面相关事件处理函数</b></span></div><div><hr/></div><ul><li>onPullDownRefresh: 下拉刷新
<ul><li>监听用户下拉刷新事件</li><li>需要在app.json的window选项中或页面配置中开启enablePullDownRefresh</li><li>当处理完数据刷新后，wx.stopPullDownRefresh可以停止当前页面的下拉刷新。</li></ul></li></ul><div><br/></div><ul><li>onReachBottom: 上拉触底
<ul><li>监听用户上拉触底事件</li><li>可以在app.json的window选项中或页面配置中设置触发距离onReachBottomDistance</li><li>在触发距离内滑动期间，本事件只会被触发一次。</li></ul></li></ul><div><br/></div><ul><li>onPageScroll: 页面滚动
<ul><li>监听用户滑动页面事件</li><li>参数为 Object，包含以下字段：scrollTop  Number 页面在垂直方向已滚动的距离（单位px）</li></ul></li></ul><div><br/></div><ul><li>onShareAppMessage: 用户转发
<ul><li>只有定义了此事件处理函数，右上角菜单才会显示“转发”按钮</li><li>用户点击转发按钮的时候会调用</li><li>此事件需要 return 一个 Object，用于自定义转发内容</li></ul></li></ul><div><table><thead><tr><th>字段</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td>title</td><td>转发标题</td><td>当前小程序名称</td></tr><tr><td>path</td><td>转发路径</td><td>当前页面 path ，必须是以 / 开头的完整路径</td></tr></tbody></table></div><div><br/></div><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>Page({<br/>
  onShareAppMessage: function () {<br/>
    return {<br/>
      title: '自定义转发标题',<br/>
      path: '/page/user?id=123'<br/>
    }<br/>
  }<br/>
})</div></div><div><br/></div><div><span style="font-size: 24px;"><b>（5）事件处理函数</b></span></div><div><hr/></div><ul><li>除了初始化数据和生命周期函数，Page 中还可以定义一些特殊的函数：事件处理函数。在渲染层可以在组件中加入事件绑定，当达到触发事件时，就会执行 Page 中定义的事件处理函数</li><li>代码例子</li></ul><div style="-en-codeblock: true; box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.14902); background-position: initial initial; background-repeat: initial initial;"><div>&lt;view bindtap=&quot;<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">viewTap</span>&quot;&gt; click me &lt;/view&gt;</div><div><br/></div><div>Page({<br/>
  <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">viewTap: function() {</span><br/>
    console.log('view tap')<br/>
  }<br/>
})</div></div><div><br/></div></span>
</div></body></html> 